<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyect Animals</title>
    <link rel="shortcut icon" type="image/png" href="img/favicon.png"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" 
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="estilos.css">
    <link rel="stylesheet" href="estilosregistro.css">
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.0/dist/jquery.validate.js"></script>

</head>
<body>
    
    <header class="formulariocentrado">
        <h2 class="text-center"> <-- Rellena los datos de tu animal aquí --></h2>
    <div class="contenedor-form">
        <div class="t">
        </div>

        <div class="formulario">
            <h2>Ficha del animal</h2>
           
                <label for="tipo">Tipo de animal :</label>
                <select name="tipo" id="tipo">
                        <option value="Perro">Perro</option>
                        <option value="Gato">Gato</option>
                        <option value="Pajaro">Pájaro</option>
                        <option value="Iguana">Iguana</option>
                        <option value="Otro">Otro</option>
                </select><br><br>
                <input type="text" id="raza" name="raza" placeholder="Raza" required>
                <input type="text" id="edad" name="edad" placeholder="Edad" > 
                <input type="text" id="nombre" name="nombre" placeholder="Nombre">
                <label for="sexo">Seleccione su género:</label><br>
                <select id="sexo" name="sexo" value="Seleccione su sexo"Required>
                    <option value="Masculino">Macho</option>
                    <option value="Femenino">Hembra</option>
                </select><br><br>
                <label for="comunidad">Seleccione una C.Autónoma:  </label>
                <select id="comunidad" name="comunidad" value="Selecciona Comunidad Autónoma" required>
	                <option value="Andalucia"  >Andaluci­a</option>
	                <option value="Aragón" >Aragón</option>
	                <option value="Principado de Asturias" >Principado de Asturias</option>
	                <option value="Islas Baleares" >Islas Baleares</option>
	                <option value="País Vasco" >Paí­s Vasco</option>
	                <option value="Islas Canarias" >Islas Canarias</option>
	                <option value="Cantabria" >Cantabria</option>
	                <option value="Castilla-La Mancha" >Castilla-La Mancha</option>
	                <option value="Castilla y León" >Castilla y León</option>
	                <option value="Cataluña" >Cataluña</option>
	                <option value="Extremadura" >Extremadura</option>
	                <option value="Galicia" >Galicia</option>
	                <option value="Comunidad de Madrid" >Comunidad de Madrid</option>
	                <option value="Región de Murcia" >Región de Murcia</option>
	                <option value="Comunidad Foral de Navarra" >Comunidad Foral de Navarra</option>
	                <option value="La Rioja">La Rioja</option>
	                <option value="Comunidad Valenciana" >Comunidad Valenciana</option>
	                <option value="Ceuta">Ceuta</option>
                    <option value="Melilla" >Melilla</option>
                   
                </select><br><br>
                <label for="provincia">Seleccione su provincia:</label>
                <br><select id="provincia" name="provincia" value="Selecciona provincia">
                  
                </select><br><br>
                
                <input type="text" id="texto" name="texto" placeholder="Descripción" >
               
               <div id="respuesta"></div>
             <center><input type="submit" class="btn btn-primary" value="Crear Ficha" id="boton"></center>
            
            
        </div>
    </div>
</header>
 
  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Sube tus imágenes</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <input type="file" id="img1">
            <input type="file" id="img2">
            <input type="file" id="img3">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
          <button type="button" class="btn btn-primary" id="subirimg">Subir imágenes</button>
        </div>
      </div>
    </div>
  </div>

<script src="js/jquery-3.1.1.min.js"></script>
<script src="js/login.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
</body>
<script>

$(document).ready(function() {

/*CAMBIAR FUNCION PARA PODER COGER LAS PROVINCIAS CON ALGO QUE NO SEA EL VALUE*/
$("#comunidad").change(function() {
    var val = $(this).val();
    if(val == "Andalucia"){
        console.log("Hola")
        $("#provincia").empty()
        var andalucia ="<option value='Granada'>Granada</option><option value='Málaga'>Málaga</option><option value='Sevilla'>Sevilla</option><option value='Huelva'>Huelva</option><option value='Almería'>Almería</option><option value='Cordoba'>Cordoba</option><option value='Cádiz'>Cádiz</option><option value='Jaén'>Jaén</option>"
        $("#provincia").append(andalucia)
    }
    if(val =="Aragón"){
        $("#provincia").empty()
        var Aragon ="<option value='Huesca'>Huesca</option><option value='Zaragoza'>Zaragoza</option><option value='Teruel'>Teruel</option>"
        $("#provincia").append(Aragon)
    }
    if(val =="Principado de Asturias"){
        $("#provincia").empty()
        var Asturias ="<option value='Asturias'>Asturias</option>"
        $("#provincia").append(Asturias)
    }
    if(val =="Islas Baleares"){
        $("#provincia").empty()
        var Baleares ="<option value='Palma de Mallorca'>Palma de mallorca</option><option value='Menorca'>Menorca</option><option value='Ibiza'>Ibiza</option>"
        $("#provincia").append(Baleares)
    }
    if(val =="País Vasco"){
        $("#provincia").empty()
        var Pvasco ="<option value='Álava'>Álava</option><option value='Vizcaya'>Vizcaya</option><option value='Guipuzcoa'>Guipuzcoa</option>"
        $("#provincia").append(Pvasco)
    }
    if(val =="Islas Canarias"){
        $("#provincia").empty()
        var Canarias ="<option value='Santa cruz de tenerife'>Santa cruz de tenerife</option><option value='Las palmas de gran canaria'>Las palmas de gran canaria</option><option value='Lanzarote'>Lanzarote</option><option value='Fuerteventura'>Fuerteventura</option><option value='La palma'>La palma</option><option value='Hierro'>Hierro</option><option value='La gomera'>La gomera</option>"
        $("#provincia").append(Canarias)
    }
    if(val =="Cantabria"){
        $("#provincia").empty()
        var Cantabria ="<option value='Cantabria'>Cantabria</option>"
        $("#provincia").append(Cantabria)
    }
    if(val =="Castilla-La Mancha"){
        $("#provincia").empty()
        var Mancha ="<option value='Toledo'>Toledo</option><option value='Guadalajara'>Guadalajara</option><option value='Cuenca'>Cuenca</option><option value='Albacete'>Albacete</option><option value='Ciudad Real'>Ciudad Real</option>"
        $("#provincia").append(Mancha)
    }
    if(val =="Castilla y León"){
        $("#provincia").empty()
        var Leon ="<option value='León'>León</option><option value='Palencia'>Palencia</option><option value='Valladolid'>Valladolid</option><option value='Salamanca'>Salamanca</option><option value='Zamora'>Zamora</option><option value='Ávila'>Ávila</option><option value='Segovia'>Segovia</option><option value='Burgos'>Burgos</option><option value='Soria'>Soria</option>"
        $("#provincia").append(Leon)
    }
    if(val =="Cataluña"){
        $("#provincia").empty()
        var Cataluña ="<option value='Barcelona'>Barcelona</option><option value='Tarragona'>Tarragona</option><option value='Lleida'>Lleida</option><option value='Girona'>Girona</option>"
        $("#provincia").append(Cataluña)
    }
    if(val =="Extremadura"){
        $("#provincia").empty()
        var Extremadura ="<option value='Badajoz'>Badajoz</option><option value='Cáceres'>Cáceres</option>"
        $("#provincia").append(Extremadura)
    }
    if(val =="Galicia"){
        $("#provincia").empty()
        var Galicia ="<option value='A Coruña'>A Coruña</option><option value='Lugo'>Lugo</option><option value='Pontevedra'>Pontevedra</option><option value='Ourense'>Ourense</option>"
        $("#provincia").append(Galicia)
    }
    if(val =="Comunidad de Madrid"){
        $("#provincia").empty()
        var Madrid ="<option value='Madrid'>Madrid</option>"
        $("#provincia").append(Madrid)
    }
    if(val =="Región de Murcia"){
        $("#provincia").empty()
        var Murcia ="<option value='Murcia'>Murcia</option>"
        $("#provincia").append(Murcia)
    }
    if(val =="Comunidad Foral de Navarra"){
        $("#provincia").empty()
        var Navarra ="<option value='Navarra'>Navarra</option>"
        $("#provincia").append(Navarra)
    }
    if(val =="La Rioja"){
        $("#provincia").empty()
        var Rioja ="<option value='La Rioja'>La Rioja</option>"
        $("#provincia").append(Rioja)
    }
    if(val =="Comunidad Valenciana"){
        $("#provincia").empty()
        var CV ="<option value='Alicante'>Alicante</option><option value='Valencia'>Valencia</option><option value='Castellón'>Castellón</option>"
        $("#provincia").append(CV)
    }
    if(val =="Ceuta"){
        $("#provincia").empty()
        var Ceuta ="<option value='Ceuta'>Ceuta</option>"
        $("#provincia").append(Ceuta)
    }
    if(val =="Melilla"){
        $("#provincia").empty()
        var Melilla ="<option value='Melilla'>Melilla</option>"
        $("#provincia").append(Melilla)
    }
});
});

$("#boton").on("click",function(){
   
    var nombre = $("#nombre").val();
    var tipo = $("#tipo").val();
    var edad = $("#edad").val();
    var raza = $("#raza").val();
    var ciudad = $("#comunidad").val();
    var provincia = $("#provincia").val();
    var detalles = $("#texto").val();
    var sexo = $("#sexo").val();
      

    /*Cambiar "Ciudad" por "Comunidad"*/
    if(typeof nombre === "undefined"){
            alert("El campo es obligatorio, inserte un nombre.")/*Estos son para validar que no estan vacios*/
        }else if ( typeof tipo === "undefined" ){
            alert("El campo  es obligatorio.")
        }else if( typeof edad === "undefined" ){
            alert("El campo de edad es obligatorio, introduzca su edad.")
        }else if( typeof raza === "undefined" ){
            alert("El campo es obligatorio, introduzca la raza del animal correspondiente.")
        }else if( typeof ciudad === "undefined" ){
            alert("El campo es obligatorio, selecciones su comunidad autónoma")
        }else if( typeof provincia === "undefined" ){
            alert("El campo es obligatorio, seleccione la provincia")
        }else if( typeof detalles === "undefined" ){
            alert("El campo es obligatorio, introduzca detalles acerca de su animal")
            
        }else if( typeof sexo === "undefined" ){
            alert("El campo es obligatorio, seleccione el sexo de su animal")
        }else if(detalles.lenght > 255){ /*Validar que si el tamaño del num es inferior a 9 digitos o superior meta alert*/
            alert("Los detalles pueden tener un máximo de 255 caracteres")
        }else if (tipo.includes([".jpg"||".png"||".jpeg"||".py"||".exe"])|| edad.includes([".jpg"||".png"||".jpeg"||".py"||".exe"])||raza.includes([".jpg"||".png"||".jpeg"||".py"||".exe"])||ciudad.includes([".jpg"||".png"||".jpeg"||".py"||".exe"])||nombre.includes([".jpg"||".png"||".jpeg"||".py"||".exe"])||provincia.includes([".jpg"||".png"||".jpeg"||".py"||".exe"])||detalles.includes([".jpg"||".png"||".jpeg"||".py"||".exe"])||sexo.includes([".jpg"||".png"||".jpeg"||".py"||".exe"])){
            alert("Eso no se hace")/*Validación implementada para evitar actividad maliciosa en la página*/
        }else{ var json={
        "tipo":tipo,"edad":edad,"raza":raza,"ciudad":ciudad,"nombre":nombre,"sexo":sexo,"provincia":provincia,"detalles":detalles
        }
        $.ajax({
            type:"POST",
            url:"http://127.0.0.1:8000/adp",
            dataType: 'json',
            headers:{
                Authorization:localStorage.getItem("token")
            } ,
            data: {
                json: JSON.stringify(json)
            }, 
            success: function (response) {
                if (response.code === 200) {
                    var codigo = "<div class='alert alert-success' role='alert'> " + response.message + "Ten en cuenta que si añades fotos tendrás más opciones de que tu animal sea adoptado. Haz click <a href='' data-toggle='modal' data-target='#exampleModal' data-id='"+response.adp.id+"'>aquí</a> para subir hasta 3 imágenes, o haz click <a href='principal.html'>aquí</a> para ir a la página principal </div>";
                    $("#respuesta").html(codigo)
                    console.log("Esto pasa por aqui")
                }
                if (response.code === 404) {
                    console.log(response)
                    console.log('1')
                    if (typeof response.message.tipo !== 'undefined') {
                        var codigo = "<div class=\"alert alert-danger\" role=\"alert\">\n" + response.errors.tipo + "</div>";
                        $("#respuesta").html(codigo)
                        console.log('2')
                    }
                    if (typeof response.message.edad !== 'undefined') {
                        var codigo = "<div class=\"alert alert-danger\" role=\"alert\">\n" + response.errors.edad + "</div>";
                        $("#respuesta").html(codigo)
                        console.log('entramos2')
                        console.log('3')
                    }
                    if (typeof response.message.raza !== 'undefined') {
                        var codigo = "<div class=\"alert alert-danger\" role=\"alert\">\n" + response.errors.raza + "</div>";
                        $("#respuesta").html(codigo)
                        console.log('4')
                    }
                    if (typeof response.message.comunidad !== 'undefined') {
                        var codigo = "<div class=\"alert alert-danger\" role=\"alert\">\n" + response.errors.comunidad + "</div>";
                        $("#respuesta").html(codigo)
                        console.log('5')
                    }
                    if (typeof response.message.provincia !== 'undefined') {
                        var codigo = "<div class=\"alert alert-danger\" role=\"alert\">\n" + response.errors.provincia + "</div>";
                        $("#respuesta").html(codigo)
                        console.log('6')
                    }
                    if (typeof response.message.detalles !== 'undefined') {
                        var codigo = "<div class=\"alert alert-danger\" role=\"alert\">\n" + response.errors.detalles + "</div>";
                        $("#respuesta").html(codigo)
                        console.log('7')
                    }
                    if (typeof response.message.image_0 !== 'undefined') {
                        var codigo = "<div class=\"alert alert-danger\" role=\"alert\">\n" + response.errors.image_1 + "</div>";
                        $("#respuesta").html(codigo)
                        console.log('8')
                    }
                    if (typeof response.message.image_1 !== 'undefined') {
                        var codigo = "<div class=\"alert alert-danger\" role=\"alert\">\n" + response.errors.image_2 + "</div>";
                        $("#respuesta").html(codigo)
                        console.log('9')
                    }
                    if (typeof response.message.image_4 !== 'undefined') {
                        var codigo = "<div class=\"alert alert-danger\" role=\"alert\">\n" + response.errors.image_3 + "</div>";
                        $("#respuesta").html(codigo)
                        console.log('10')
                    }
                }
            }
        })
        }
        
    })
    $("#subirimg").on("click", function(){
        var formData= new formData();
    $.ajax({
        url:'http://127.0.0.1:8000/adp/new/img/s',
        type: 'POST',
        success: function(response){
            if(response.code===200){
                alert('Se han subido correctamente.')
            }if (response.code===404){
                alert('No se han podido subir las imágenes correctamente, vuelve a intentarlo.')
            }
        }
    })
    })
    $(document).ready(function(){
     var prueba = localStorage.getItem("token");
    }) 
    
</script>
</html>
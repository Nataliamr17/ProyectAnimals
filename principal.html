<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proyect Animals</title>
  <link rel="shortcut icon" type="image/png" href="img/favicon.png" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <link rel="stylesheet" href="principal.css">
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css" integrity="sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V" crossorigin="anonymous">
</head>

<body>

  <div class="container-fluid">
    <div class="row">
      <div class="col-xl-12">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
          <a class="navbar-brand" href="principal.html"><img src="img/logo.png" width="100px"></a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse d-flex justify-content-around" id="navbarNav">
            <ul class="navbar-nav ">
              <li class="nav-item active">
                <a class="nav-link" href="principal.html">INICIO</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="ficha.html">CREAR FICHA</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="perfil.html">TU PERFIL<span class="sr-only">(current)</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="mensajes.html">MENSAJES<span class="sr-only">(current)</span></a>
              </li>
              <li class="nav-item">
              </li>
            </ul>
            <span class="navbar-text">
              <div id="datosusu"> 
              </div>
              
            </span>
          </div>
        </nav>
      </div>
    </div>
    <div class="row">
      <div class="col-xl-2 col-md-2 col-xs-1">
        <div class="bg-secondary text-white">
          <ul id="animal"><br>
            <div class="caja" id="testi">ANIMAL</div>
            <input name="animal" type="checkbox" value="perro" id="perro"> Perro <br>
            <input name="animal" type="checkbox" value="gato" id="gato"> Gato <br>
            <input name="animal" type="checkbox" value="pajaro" id="pajaro"> Pájaro <br> 
            <input name="animal" type="checkbox" value="iguana" id="iguana"> Iguana <br>
            <input name="animal" type="checkbox" value="otro" id="otro"> Otro <br>
          </ul>
          <ul id="sexobusc">
            <div class="caja">SEXO</div>
            <input name="sexo" type="checkbox" value="macho" id="macho"> Macho <br>
            <input name="sexo" type="checkbox" value="hembra" id="hembra"> Hembra <br>
          </ul>
          <ul id="ccaa">
            <div class="caja">COMUNIDAD AUTONOMA</div>
            <input name="ccaa" type="checkbox" value="andalucia"> Andalucía <br>
            <input name="ccaa" type="checkbox" value="aragon"> Aragón <br> 
            <input name="ccaa" type="checkbox" value="cantabria"> Cantabria <br> 
            <input name="ccaa" type="checkbox" value="mancha"> Castilla la Mancha <br> 
            <input name="ccaa" type="checkbox" value="leon"> Castilla León <br> 
            <input name="ccaa" type="checkbox" value="cataluña"> Cataluña <br> 
            <input name="ccaa" type="checkbox" value="ceuta"> Ceuta <br> 
            <input name="ccaa" type="checkbox" value="madrid"> Comunidad de Madrid <br> 
            <input name="ccaa" type="checkbox" value="navarra"> Comunidad Foral de Navarra <br> 
            <input name="ccaa" type="checkbox" value="valenciana"> Comunidad Valenciana <br> 
            <input name="ccaa" type="checkbox" value="extremadura"> Extremadura <br> 
            <input name="ccaa" type="checkbox" value="galicia"> Galicia <br>
            <input name="ccaa" type="checkbox" value="baleares"> Islas Baleares <br> 
            <input name="ccaa" type="checkbox" value="canarias"> Islas Canarias <br>
            <input name="ccaa" type="checkbox" value="rioja"> La Rioja <br>
            <input name="ccaa" type="checkbox" value="melilla"> Melilla <br>
            <input name="ccaa" type="checkbox" value="paisvasco"> País Vasco <br>
            <input name="ccaa" type="checkbox" value="asturias"> Principado de Asturias <br>
            <input name="ccaa" type="checkbox" value="murcia"> Región de Murcia <br>
          </ul> 
        </div>


      </div>
      <div class="col-xl-10 col-md-10 col-xs-1">
        <div id="prueba">
        </div>
      </div>
    </div>
  </div>
  <!-- Modal -->
  <div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="titulo"></h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <!-- Esto es el carrussel -->
          <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">
              <div class="carousel-item active mh-80" id="foto1">
              </div>
              <div class="carousel-item mh-80" id="foto2">

              </div>
              <div class="carousel-item mh-80" id="foto3">

              </div>
            </div>
            <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="sr-only">Next</span>
            </a>
          </div>
          <div class="col-md-12">
            <ul class="list-group">
              <li class="list-group-item list-group-item-info" id="tipo"></li>
              <li class="list-group-item list-group-item-info" id="raza"></li>
              <li class="list-group-item list-group-item-info" id="edad"></li>
              <li class="list-group-item list-group-item-info" id="sexo"></li>
              <li class="list-group-item list-group-item-info" id="ccaa"></li>
              <li class="list-group-item list-group-item-info" id="provincia"></li>

            </ul>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Volver</button>
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal"
            data-whatever="@mdo" id="sms">¡Me interesa!</button>

        </div>
      </div>

      <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Nuevo Mensaje</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form>
                <div class="form-group">
                  <label for="recipient-name" class="col-form-label">Destinatario:</label>
                  <input type="text" class="form-control" id="destinatario">
                </div>
                <div class="form-group">
                  <label for="message-text" class="col-form-label">Mensaje:</label>
                  <textarea class="form-control" id="texto"></textarea>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
              <button type="button" class="btn btn-primary" id="enviarsms">Enviar mensaje</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <script src="js/jquery-3.1.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
    integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
    crossorigin="anonymous"></script>
</body>
<script>

  $(document).ready(function () {
    if(localStorage.getItem("username") !== "undefined"){
      $("#datosusu").html("Bienvenido: "+localStorage.getItem("username")+' ! <i class="fas fa-sign-out-alt" id="logout"></i>')
    }
      $(document).on("click","#logout",function(){
        localStorage.removeItem("token")
        localStorage.removeItem("userid")
        localStorage.removeItem("username")
        alert("Sesión cerrada.")/* to do: Cambiar redirect por entradas dinamicas de li en funcion de si esta logged o no*/
        document.location.href="index.html";
      })
    console.log("holaestoyaqui");
    $.ajax({
      type: 'GET',
      url: 'http://127.0.0.1:8000/adp',
      success: function (response) {
        console.log(response)
        for (var i = 0; i < response.length; i++) {
          console.log(response[i]);
          var card = "<div class='card float-left mt-3 mr-3' style='width: 18rem;'><img src=' http://127.0.0.1:8000/adp/img/" + response[i].image_1 + "' class='card-img-top'><div class='card-body'><h5 class='card-title'>" + response[i].nombre +
            "</h5><p class='card-text'>" + response[i].detalles +
            "</p><div class='botonficha'><button type='button' class='btn btn-primary' id='botonficha' data-toggle='modal' data-target='#exampleModalLong' data-id='" + response[i].id +
            "'>Ficha</button></div></div></div>";
          $("#prueba").append(card)
        }
      }
    })
    $('#animal').on("change", function (){
      var perro = false;
      var gato = false;
      var pajaro = false;
      var iguana = false;
      var otro = false;
      if ($('#perro').is(':checked')) {
        perro = true;
      }
      if ($('#gato').is(':checked')) {
        gato = true;
      }
      if ($('#pajaro').is(':checked')) {
        pajaro = true;
      }
      if ($('#iguana').is(':checked')) {
        iguana = true;
      }
      if ($('#otro').is(':checked')) {
        otro = true;
      }
      $.ajax({
        type: 'GET',
        url: 'http://127.0.0.1:8000/adp',
        success: function (response) {
          $("#prueba").empty();
          for (var i = 0; i < response.length; i++) {
            if (perro === true) {
              if (response[i].tipo === 'Perro') {
                  var card = "<div class='card float-left mt-3 mr-3' style='width: 18rem;'><img src=' http://127.0.0.1:8000/adp/img/" + response[i].image_1 + "' class='card-img-top'><div class='card-body'><h5 class='card-title'>" + response[i].nombre +
                  "</h5><p class='card-text'>" + response[i].detalles +
                  "</p><div class='botonficha'><button type='button' class='btn btn-primary' id='botonficha' data-toggle='modal' data-target='#exampleModalLong' data-id='" + response[i].id +
                  "'>Ficha</button></div></div></div>";
                $("#prueba").append(card)
              }
            }
            else if(gato === true) {
              if (response[i].tipo === 'Gato') {
                  var card = "<div class='card float-left mt-3 mr-3' style='width: 18rem;'><img src=' http://127.0.0.1:8000/adp/img/" + response[i].image_1 + "' class='card-img-top'><div class='card-body'><h5 class='card-title'>" + response[i].nombre +
                  "</h5><p class='card-text'>" + response[i].detalles +
                  "</p><div class='botonficha'><button type='button' class='btn btn-primary' id='botonficha' data-toggle='modal' data-target='#exampleModalLong' data-id='" + response[i].id +
                  "'>Ficha</button></div></div></div>";
                $("#prueba").append(card)
              }
            }
            else if(pajaro === true) {
              if (response[i].tipo === 'Pajaro') {
                  var card = "<div class='card float-left mt-3 mr-3' style='width: 18rem;'><img src=' http://127.0.0.1:8000/adp/img/" + response[i].image_1 + "' class='card-img-top'><div class='card-body'><h5 class='card-title'>" + response[i].nombre +
                  "</h5><p class='card-text'>" + response[i].detalles +
                  "</p><div class='botonficha'><button type='button' class='btn btn-primary' id='botonficha' data-toggle='modal' data-target='#exampleModalLong' data-id='" + response[i].id +
                  "'>Ficha</button></div></div></div>";
                $("#prueba").append(card)
              }
            }
            else if(iguana === true) {
              if (response[i].tipo === 'Iguana') {
                  var card = "<div class='card float-left mt-3 mr-3' style='width: 18rem;'><img src=' http://127.0.0.1:8000/adp/img/" + response[i].image_1 + "' class='card-img-top'><div class='card-body'><h5 class='card-title'>" + response[i].nombre +
                  "</h5><p class='card-text'>" + response[i].detalles +
                  "</p><div class='botonficha'><button type='button' class='btn btn-primary' id='botonficha' data-toggle='modal' data-target='#exampleModalLong' data-id='" + response[i].id +
                  "'>Ficha</button></div></div></div>";
                $("#prueba").append(card)
              }
            }
            else if(otro === true) {
              if (response[i].tipo === 'Otro') {
                  var card = "<div class='card float-left mt-3 mr-3' style='width: 18rem;'><img src=' http://127.0.0.1:8000/adp/img/" + response[i].image_1 + "' class='card-img-top'><div class='card-body'><h5 class='card-title'>" + response[i].nombre +
                  "</h5><p class='card-text'>" + response[i].detalles +
                  "</p><div class='botonficha'><button type='button' class='btn btn-primary' id='botonficha' data-toggle='modal' data-target='#exampleModalLong' data-id='" + response[i].id +
                  "'>Ficha</button></div></div></div>";
                $("#prueba").append(card)
              }
            }
          }
        }
      })
    })
  $('#sexobusc').on("change", function(){
    var macho= false;
    var hembra = false;
    if($('#macho').is(':checked')){
      macho = true;
    }
    if($('#hembra').is(':checked')){
      hembra = true;
    }
    $.ajax({
      type: 'GET',
      url: 'http://127.0.0.1:8000/adp',
      success: function(response){
        $("#prueba").empty();
        for (var i = 0; i < response.length; i++) {
          if (macho === true) {
              if (response[i].sexo === 'Masculino') {
                  var card = "<div class='card float-left mt-3 mr-3' style='width: 18rem;'><img src=' http://127.0.0.1:8000/adp/img/" + response[i].image_1 + "' class='card-img-top'><div class='card-body'><h5 class='card-title'>" + response[i].nombre +
                  "</h5><p class='card-text'>" + response[i].detalles +
                  "</p><div class='botonficha'><button type='button' class='btn btn-primary' id='botonficha' data-toggle='modal' data-target='#exampleModalLong' data-id='" + response[i].id +
                  "'>Ficha</button></div></div></div>";
                $("#prueba").append(card)
              }
            }
            else if (hembra === true) {
              if (response[i].sexo === 'Femenino') {
                  var card = "<div class='card float-left mt-3 mr-3' style='width: 18rem;'><img src=' http://127.0.0.1:8000/adp/img/" + response[i].image_1 + "' class='card-img-top'><div class='card-body'><h5 class='card-title'>" + response[i].nombre +
                  "</h5><p class='card-text'>" + response[i].detalles +
                  "</p><div class='botonficha'><button type='button' class='btn btn-primary' id='botonficha' data-toggle='modal' data-target='#exampleModalLong' data-id='" + response[i].id +
                  "'>Ficha</button></div></div></div>";
                $("#prueba").append(card)
              }
            }
        }
      }
    })
  })
  })
  $(document).on("click", "#botonficha", function () {
    var id = $(this).data("id")
    console.log(id);
    $.ajax({
      type: 'GET',
      url: 'http://127.0.0.1:8000/adp/' + id,
      success: function (response) {
        $('#foto1').empty();
        $('#foto2').empty();
        $('#foto3').empty();
        $('#foto1').append("<img src='http://127.0.0.1:8000/adp/img/" + response.adopcion.image_1 + "'></img>")
        $('#foto2').append("<img src='http://127.0.0.1:8000/adp/img/" + response.adopcion.image_2 + "'></img>")
        $('#foto3').append("<img src='http://127.0.0.1:8000/adp/img/" + response.adopcion.image_3 + "'></img>")

        $('#titulo').empty();
        $('#titulo').append(response.adopcion.nombre)
        $('#tipo').empty();
        $('#tipo').append('Tipo:  ' + response.adopcion.tipo)
        $('#raza').empty();
        $('#raza').append('Raza:  ' + response.adopcion.raza)
        $('#edad').empty();
        $('#edad').append('Edad:  ' + response.adopcion.edad)
        $('#sexo').empty();
        $('#sexo').append('Sexo:  ' + response.adopcion.sexo)
        $('#ccaa').empty();
        $('#ccaa').append('CCAA:  ' + response.adopcion.cuidad)
        $('#provincia').empty();
        $('#provincia').append('Provincia:  ' + response.adopcion.provincia)
        $('#sms').removeAttr("user-id");
        $('#sms').attr("user-id", response.adopcion.usuarios_id)

      }
    })
    $(document).on("click", "#sms", function () {
      var user = $('#sms').attr("user-id")
      $('#destinatario').val(user)
    })
    $(document).on("click", "#enviarsms", function () {
      var destinatario = $('#destinatario').val()
      var texto = $('#texto').val()
      var titulo = 'Hola, estoy interesada en tu mascota!'
      var json = {
        'to_users_id': destinatario,
        'titulo': titulo,
        'contenido': texto,
      }
      $.ajax({
        type: 'POST',
        url: 'http://127.0.0.1:8000/msj',
        headers: {
          Authorization: localStorage.getItem("token")
        },
        data: {
          json: JSON.stringify(json)
        },
        success: function (response) {
          if (response.code === 200) {
            alert("Mensaje enviado correctamente.")
            document.location.href = "principal.html";
          }
          else {
            alert(response.message)
          }
        }
      })

    })
  })
</script>

</html>